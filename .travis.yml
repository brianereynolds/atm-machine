language: java
env:
  - secure: TODO
  - secure: TODO
  - secure: TODO

addons:
  sonarcloud:
    organization: "brianereynolds-github"
    token:
      secure: T9OxbUF/2aLgzJpSgYNpoxzZvyMMKNt7yFWJ1OQFk8UbRXPjefi5hM803dlZgp1X2XbE1umcPiuFNuF5PL5xOSwk9SsnIORm3/fCIL4+S7s4wxsAl+CGaVACxBEOnwkuYlZ662viuQ1mHqaOAOZ0GIwBjUMRCF6lWCQ28SqZLQpeXjCH/p9wLdeyuLjR6PMQBrIoiNX6w7CZFeFfGn3xpOMZItfme35/rbZrJ+dIpnuAyjV8B2coovaUDXqBBFjhVCkeSJO5Sv6G0ovNSh4V4RL9hr8TG+WxZuE/jsRvaZ5B8iIDwExBsiIyVJKnOhDz1cXV/8s+3ysJo74wtO1v2FU4lAT1+BHhWcwa2mdHjATFyAltsGZwzFsAw/W8PqWtFRkxBnjW8dE5q8IKg0uWA9GIljOSZaqKvyJhA8vcLpZkekeNqUazdZ11R6tUs/BDIapoAY3xN3qn/KFQla0crZK9n6I2AvYlI5gkjF4V5N0i3eGXcwDLeaEQS8tZ7yzFrP4Sba/QsuP/qy4FhQqhm21p8i8St+Xs701lzlxOn7/oMmbIRGfCQ3jIMu+kLgOIstgtQjInmt8fKzvulRj90ab0MR3HKc145Dszryf1oZK9f/MtmPTKMF2zS5jfzXrCAAy5lguluYLpIuH1/+BeRo64pMZyBHwIi7xgRlDnGz0=

script:
  - sonar-scanner

after_success:
  - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
  - export REPO=$DOCKER_USERNAME/atm-machine
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO .
  - docker tag `docker images -q $REPO` $REPO:$TAG
  - docker push $REPO
  global:
